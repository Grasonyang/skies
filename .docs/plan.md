# Skies - ç©ºæ°£å“è³ªç›£æ¸¬ç³»çµ±å®Œæ•´è¦åŠƒ

> ğŸ“… **æœ€å¾Œæ›´æ–°**: 2025-01-04  
> ğŸ“‹ **ç•¶å‰éšæ®µ**: è¨­è¨ˆå®Œæˆï¼Œæº–å‚™é–‹ç™¼  
> ğŸ¯ **ç›®æ¨™**: å»ºç«‹å®‰å…¨ã€ç¶“æ¿Ÿã€ç”¨æˆ¶å‹å¥½çš„ç©ºæ°£å“è³ªç›£æ¸¬å¹³å°

---

## ğŸ“‹ ç›®éŒ„

1. [å°ˆæ¡ˆæ¦‚è¿°](#å°ˆæ¡ˆæ¦‚è¿°)
2. [æ ¸å¿ƒè¨­è¨ˆæ±ºç­–](#æ ¸å¿ƒè¨­è¨ˆæ±ºç­–)
3. [æŠ€è¡“æ¶æ§‹](#æŠ€è¡“æ¶æ§‹)
4. [ç”¨æˆ¶é«”é©—æµç¨‹](#ç”¨æˆ¶é«”é©—æµç¨‹)
5. [æ•¸æ“šç­–ç•¥](#æ•¸æ“šç­–ç•¥)
6. [å¯¦ç¾è¨ˆåŠƒ](#å¯¦ç¾è¨ˆåŠƒ)
7. [æˆæœ¬åˆ†æ](#æˆæœ¬åˆ†æ)
8. [é–‹ç™¼æŒ‡å—](#é–‹ç™¼æŒ‡å—)

---

## å°ˆæ¡ˆæ¦‚è¿°

### ç›®æ¨™
åŸºæ–¼ Google Air Quality APIã€Next.js å’Œ Google Maps æ§‹å»ºå³æ™‚ç©ºæ°£å“è³ªç›£æ¸¬èˆ‡è¦–è¦ºåŒ–ç³»çµ±ã€‚

### æŠ€è¡“æ£§
- **å‰ç«¯**: Next.js 15.5.4 (App Router) + React 19.1.0
- **åœ°åœ–**: @vis.gl/react-google-maps
- **æ¨£å¼**: Tailwind CSS 4.1.14
- **èªè¨€**: TypeScript 5
- **API**: Google Maps JavaScript API + Google Air Quality API

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ—ºï¸ äº’å‹•å¼åœ°åœ–é¡¯ç¤º
- ğŸ“ è‡ªå‹•ç”¨æˆ¶å®šä½ï¼ˆGPS â†’ IP â†’ é è¨­ï¼‰
- ğŸŒ¡ï¸ å³æ™‚ç©ºæ°£å“è³ªæ•¸æ“š
- ğŸ¨ ç†±åŠ›åœ–å±¤å€åŸŸæ¦‚æ³
- ğŸ” é»æ“ŠæŸ¥è©¢è©³ç´°è³‡è¨Š
- ğŸ“Š æ±¡æŸ“ç‰©æ•¸æ“šå±•ç¤º

---

## æ ¸å¿ƒè¨­è¨ˆæ±ºç­–

### 1. ç”¨æˆ¶ä½ç½®ç²å– - ä¸‰å±¤é™ç´šç­–ç•¥

```
ç¬¬ 1 å±¤: GPS å®šä½ï¼ˆå„ªå…ˆï¼‰
   â†“ å¤±æ•—ï¼ˆ5ç§’è¶…æ™‚ï¼‰
ç¬¬ 2 å±¤: IP å®šä½ï¼ˆé™ç´šï¼‰
   â†“ å¤±æ•—
ç¬¬ 3 å±¤: é è¨­å°åŒ—å¸‚ä¸­å¿ƒï¼ˆä¿åº•ï¼‰
```

**å¯¦ç¾**:
```typescript
// hooks/useGeolocation.ts
async function getInitialLocation() {
  try {
    // ç¬¬ 1 å±¤: GPS
    const position = await navigator.geolocation.getCurrentPosition();
    return { lat, lng, accuracy, source: 'gps' };
  } catch {
    try {
      // ç¬¬ 2 å±¤: IP
      const data = await fetch('https://ipapi.co/json/');
      return { lat, lng, accuracy: 5000, source: 'ip' };
    } catch {
      // ç¬¬ 3 å±¤: é è¨­
      return { lat: 25.033, lng: 121.5654, source: 'default' };
    }
  }
}
```

**æ•ˆæœ**: 100% ç”¨æˆ¶éƒ½èƒ½æ­£å¸¸ä½¿ç”¨

---

### 2. åœ°åœ–ç¸®æ”¾ç´šåˆ¥ - å‹•æ…‹ Zoom 13

```
å®šä½ç²¾åº¦          â†’ ç¸®æ”¾ç´šåˆ¥ â†’ è¦–é‡ç¯„åœ
GPS < 100m       â†’ Zoom 15  â†’ è¡—å€ç´š
GPS 100-500m     â†’ Zoom 14  â†’ å€åŸŸç´š
GPS 500-2000m    â†’ Zoom 13  â†’ åŸå¸‚ç´šï¼ˆé è¨­æ¨è–¦ï¼‰â­
IP/é è¨­å®šä½      â†’ Zoom 12  â†’ å¤§å€åŸŸ
```

**ç†ç”±**: å¹³è¡¡è¦–é‡èˆ‡ç´°ç¯€ï¼Œåˆå§‹æŸ¥è©¢ 9 æ¬¡ï¼ˆ3x3 ç¶²æ ¼ï¼‰æˆæœ¬å¯æ§

---

### 3. æ•¸æ“šé¡¯ç¤º - ç†±åŠ›åœ– + å‹•æ…‹ç¶²æ ¼

```
ç­–ç•¥ 1: ç†±åŠ›åœ–å±¤ï¼ˆå€åŸŸæ¦‚æ³ï¼‰
- Heatmap Tiles APIï¼ˆå…è²»ï¼‰
- æ‰€æœ‰ç¸®æ”¾ç´šåˆ¥éƒ½é¡¯ç¤º
- ç¾è§€æµæš¢

ç­–ç•¥ 2: å‹•æ…‹ç¶²æ ¼ï¼ˆç²¾ç¢ºæ•¸æ“šï¼‰
- Zoom < 12:  ä¸æŸ¥è©¢
- Zoom 12-13: 3x3 ç¶²æ ¼ï¼ˆ9 æ¬¡ï¼‰
- Zoom 14-15: 5x5 ç¶²æ ¼ï¼ˆ25 æ¬¡ï¼‰
- Zoom 16+:   æŒ‰éœ€æŸ¥è©¢ï¼ˆç”¨æˆ¶é»æ“Šï¼‰

ç­–ç•¥ 3: å¿«å–å„ªåŒ–
- TTL: 5-10 åˆ†é˜
- å‘½ä¸­ç‡: 70%
- æˆæœ¬é™ä½: 70%
```

**æˆæœ¬å°æ¯”**ï¼ˆ10,000 MAUï¼‰:
- ç„¡å„ªåŒ–: $1,050/æœˆ
- æœ‰å„ªåŒ–: $105/æœˆ â­

---

### 4. åœ°åœ–ç§»å‹• - æ™ºèƒ½è¿½è¹¤ + é˜²æŠ–

```
ç”¨æˆ¶ç§»å‹•åœ°åœ–
    â†“
åœæ­¢ç§»å‹•ï¼ˆ1ç§’é˜²æŠ–ï¼‰
    â†“
æª¢æŸ¥ç¸®æ”¾ç´šåˆ¥
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Zoom<12  â”‚ Zoom 12-15 â”‚ Zoom>15  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“            â†“           â†“
ä¸è‡ªå‹•æŸ¥è©¢   è‡ªå‹•æ›´æ–°ç¶²æ ¼   æç¤ºé»æ“Š
åªé¡¯ç¤ºç†±åŠ›åœ–   æŸ¥è©¢æ–°é»     æŒ‰éœ€æŸ¥è©¢
```

**æ•ˆæœ**: é¿å…é »ç¹ API èª¿ç”¨ï¼Œç”¨æˆ¶é«”é©—æµæš¢

---

### 5. API å®‰å…¨ - Next.js API Routes å¾Œç«¯ä»£ç†

```
âŒ éŒ¯èª¤åšæ³•:
å‰ç«¯ â†’ ç›´æ¥èª¿ç”¨ Google API
        â†“
    API Key æš´éœ²ï¼

âœ… æ­£ç¢ºåšæ³•:
å‰ç«¯ â†’ Next.js API Routes â†’ Google API
       (API Key å®‰å…¨å­˜å„²)
```

**å¯¦ç¾**:
```typescript
// app/api/air-quality/current/route.ts
export async function GET(request: NextRequest) {
  const apiKey = process.env.GOOGLE_AIR_QUALITY_API_KEY; // å®‰å…¨
  const data = await fetch(googleApiUrl, { 
    headers: { Authorization: `Bearer ${apiKey}` }
  });
  return NextResponse.json(data, {
    headers: { 'Cache-Control': 'public, s-maxage=300' }
  });
}
```

---

## æŠ€è¡“æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯å±¤ (Client)                â”‚
â”‚  Next.js App Router + React 19          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ åœ°åœ–çµ„ä»¶   â”‚  â”‚ æ•¸æ“šçµ„ä»¶   â”‚        â”‚
â”‚  â”‚ Map        â”‚  â”‚ AQIPanel   â”‚        â”‚
â”‚  â”‚ + Heatmap  â”‚  â”‚ + Markers  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Hooks                       â”‚        â”‚
â”‚  â”‚ - useGeolocation            â”‚        â”‚
â”‚  â”‚ - useAirQuality             â”‚        â”‚
â”‚  â”‚ - useMapTracking            â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        API Routes (Backend Proxy)        â”‚
â”‚  /api/air-quality/current               â”‚
â”‚  /api/air-quality/forecast              â”‚
â”‚  /api/air-quality/history               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ - API Key ä¿è­·             â”‚        â”‚
â”‚  â”‚ - å¿«å– (5-10 min)          â”‚        â”‚
â”‚  â”‚ - é€Ÿç‡é™åˆ¶                 â”‚        â”‚
â”‚  â”‚ - éŒ¯èª¤è™•ç†                 â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       æœå‹™å±¤ (Services)                  â”‚
â”‚  AirQualityService + CacheService       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       å¤–éƒ¨ API                           â”‚
â”‚  Google Air Quality API                 â”‚
â”‚  Google Maps Heatmap Tiles              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç”¨æˆ¶é«”é©—æµç¨‹

### å®Œæ•´æµç¨‹

```
1. ç”¨æˆ¶æ‰“é–‹ç¶²é 
   â†“
2. é¡¯ç¤ºè¼‰å…¥å‹•ç•«
   "æ­£åœ¨ç²å–æ‚¨çš„ä½ç½®..."
   â†“
3. å˜—è©¦ç²å–ä½ç½®ï¼ˆä¸‰å±¤é™ç´šï¼‰
   GPS â†’ IP â†’ é è¨­å°åŒ—
   â†“
4. åˆå§‹åŒ–åœ°åœ–
   - ä¸­å¿ƒé»: ç”¨æˆ¶ä½ç½®
   - ç¸®æ”¾: Zoom 13ï¼ˆå‹•æ…‹èª¿æ•´ï¼‰
   - è¼‰å…¥ç†±åŠ›åœ–å±¤
   â†“
5. æŸ¥è©¢ä¸­å¿ƒé»æ•¸æ“š
   - èª¿ç”¨ /api/air-quality/current
   - é¡¯ç¤º AQI é¢æ¿
   â†“
6. ç”¨æˆ¶äº’å‹•
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç§»å‹•åœ°åœ–   â”‚ é»æ“Šåœ°åœ–   â”‚ æœå°‹åœ°é»   â”‚
   â”‚ è‡ªå‹•æ›´æ–°   â”‚ æŸ¥è©¢è©³æƒ…   â”‚ è·³è½‰æŸ¥è©¢   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº’å‹•å„ªå…ˆç´š

```
å„ªå…ˆç´š 1: ç”¨æˆ¶é»æ“Šçš„é»ï¼ˆæœ€é«˜ï¼‰
å„ªå…ˆç´š 2: åœ°åœ–ä¸­å¿ƒé»ï¼ˆZoom 12-15ï¼‰
å„ªå…ˆç´š 3: ç”¨æˆ¶ç•¶å‰ä½ç½®ï¼ˆåˆå§‹ï¼‰
```

---

## æ•¸æ“šç­–ç•¥

### ç¸®æ”¾ç´šåˆ¥å°æ‡‰ç­–ç•¥

| Zoom | è¦–é‡ | ç­–ç•¥ | APIèª¿ç”¨ | æˆæœ¬/ç”¨æˆ¶ |
|------|------|------|---------|----------|
| 6-9 | åœ‹å®¶ | åªé¡¯ç¤ºç†±åŠ›åœ– | 0 | $0 |
| 10-11 | å¤§å€åŸŸ | ç†±åŠ›åœ– + ä¸­å¿ƒé» | 1 | $0.0005 |
| **12-13** | **åŸå¸‚** | **ç†±åŠ›åœ– + 3x3** | **9** | **$0.0045** â­ |
| 14-15 | å€åŸŸ | ç†±åŠ›åœ– + 5x5 | 25 | $0.0125 |
| 16+ | è¡—é“ | ç†±åŠ›åœ– + æŒ‰éœ€ | æŒ‰éœ€ | æŒ‰éœ€ |

### å¿«å–ç­–ç•¥

```typescript
// CacheService
class CacheService {
  private ttl = 5 * 60 * 1000; // 5 åˆ†é˜
  
  getCacheKey(lat: number, lng: number): string {
    // å››æ¨äº”å…¥åˆ° 0.01ï¼ˆç´„ 1kmï¼‰
    const roundLat = Math.round(lat * 100) / 100;
    const roundLng = Math.round(lng * 100) / 100;
    return `aqi:${roundLat}:${roundLng}`;
  }
  
  async get(key: string) {
    const cached = this.cache.get(key);
    if (!cached || Date.now() - cached.timestamp > this.ttl) {
      return null;
    }
    return cached.data;
  }
}
```

**æ•ˆæœ**: 70% å‘½ä¸­ç‡ï¼Œæˆæœ¬é™ä½ 70%

---

## å¯¦ç¾è¨ˆåŠƒ

### Phase 1: MVPï¼ˆWeek 1-2ï¼‰

#### Week 1: åŸºç¤è¨­æ–½

**Day 1-2: ä½ç½®ç²å–**
```typescript
ä»»å‹™:
- [ ] å‰µå»º hooks/useGeolocation.ts
- [ ] å¯¦ç¾ä¸‰å±¤é™ç´šç­–ç•¥
- [ ] å‰µå»ºè¼‰å…¥å‹•ç•«
- [ ] æ›´æ–° app/page.tsx

å®Œæˆæ¨™æº–:
âœ… å…è¨±å®šä½ â†’ GPS
âœ… æ‹’çµ•å®šä½ â†’ IP
âœ… IP å¤±æ•— â†’ é è¨­å°åŒ—
```

**Day 3-4: API Routes**
```typescript
ä»»å‹™:
- [ ] å‰µå»º services/airQualityService.ts
- [ ] å‰µå»º app/api/air-quality/current/route.ts
- [ ] é…ç½®ç’°å¢ƒè®Šæ•¸
- [ ] æ¸¬è©¦ API èª¿ç”¨

å®Œæˆæ¨™æº–:
âœ… API Route æ­£ç¢ºè¿”å›æ•¸æ“š
âœ… API Key ä¸æš´éœ²
âœ… éŒ¯èª¤è™•ç†å®Œå–„
```

**Day 5-7: ç†±åŠ›åœ–èˆ‡æŸ¥è©¢**
```typescript
ä»»å‹™:
- [ ] å‰µå»º components/map/HeatmapLayer.tsx
- [ ] å‰µå»º hooks/useAirQuality.ts
- [ ] å‰µå»º components/AirQualityPanel.tsx
- [ ] æ•´åˆåˆ°ä¸»é é¢

å®Œæˆæ¨™æº–:
âœ… ç†±åŠ›åœ–é¡¯ç¤ºæ­£ç¢º
âœ… é¢æ¿é¡¯ç¤º AQI æ•¸æ“š
âœ… è¦–è¦ºæ•ˆæœè‰¯å¥½
```

#### Week 2: å„ªåŒ–é«”é©—

**ä»»å‹™æ¸…å–®**:
- [ ] åœ°åœ–ç§»å‹•è¿½è¹¤ï¼ˆé˜²æŠ– 1 ç§’ï¼‰
- [ ] å‹•æ…‹ç¶²æ ¼é¡¯ç¤ºï¼ˆæ ¹æ“š Zoomï¼‰
- [ ] é»æ“ŠæŸ¥è©¢åŠŸèƒ½
- [ ] åœ°é»æœå°‹ï¼ˆGoogle Placesï¼‰
- [ ] å¿«å–å¯¦ç¾ï¼ˆMemory Cacheï¼‰

**å®Œæˆæ¨™æº–**:
- âœ… ç§»å‹•åœ°åœ–è‡ªå‹•æ›´æ–°ï¼ˆZoom 12-15ï¼‰
- âœ… é»æ“Šä»»æ„ä½ç½®æŸ¥è©¢
- âœ… æœå°‹åœ°é»è·³è½‰
- âœ… å¿«å–å‘½ä¸­ç‡ > 60%

---

### Phase 2: é€²éšåŠŸèƒ½ï¼ˆWeek 3-4ï¼‰

**åŠŸèƒ½åˆ—è¡¨**:
- [ ] æ­·å²æ•¸æ“šæŸ¥è©¢
- [ ] æ•¸æ“šåœ–è¡¨ï¼ˆChart.jsï¼‰
- [ ] æ±¡æŸ“ç‰©è©³æƒ…é¢æ¿
- [ ] å¥åº·å»ºè­°
- [ ] æ”¶è—åœ°é»åŠŸèƒ½

---

### Phase 3: å®Œå–„èˆ‡éƒ¨ç½²ï¼ˆWeek 5-6ï¼‰

**ä»»å‹™åˆ—è¡¨**:
- [ ] éŒ¯èª¤é‚Šç•Œè™•ç†
- [ ] è¼‰å…¥éª¨æ¶å±
- [ ] éŸ¿æ‡‰å¼è¨­è¨ˆï¼ˆæ‰‹æ©Ÿç‰ˆï¼‰
- [ ] æ€§èƒ½å„ªåŒ–ï¼ˆLighthouse > 90ï¼‰
- [ ] éƒ¨ç½²åˆ° Vercel
- [ ] è¨­ç½®ç›£æ§ï¼ˆSentryï¼‰

---

## æˆæœ¬åˆ†æ

### Google Air Quality API å®šåƒ¹
```
å‰ 10,000 æ¬¡/æœˆ: å…è²»
ä¹‹å¾Œ: $5 / 1,000 æ¬¡
```

### å ´æ™¯åˆ†æï¼ˆ10,000 MAUï¼‰

#### å ´æ™¯ 1: MVP ç„¡å¿«å–
```
æ¯ç”¨æˆ¶: åˆå§‹ 1 + ç§»å‹• 5 + é»æ“Š 2 = 8 æ¬¡
ç¸½èª¿ç”¨: 80,000 æ¬¡/æœˆ
è²»ç”¨: (80,000 - 10,000) Ã— $0.005 = $350/æœˆ
```

#### å ´æ™¯ 2: MVP æœ‰å¿«å–ï¼ˆæ¨è–¦ï¼‰â­
```
å¿«å–å‘½ä¸­ç‡: 70%
å¯¦éš›èª¿ç”¨: 80,000 Ã— 30% = 24,000 æ¬¡/æœˆ
è²»ç”¨: (24,000 - 10,000) Ã— $0.005 = $70/æœˆ
```

#### å ´æ™¯ 3: å®Œæ•´åŠŸèƒ½
```
æ¯ç”¨æˆ¶: 12 æ¬¡ï¼ˆå«æ­·å²æŸ¥è©¢ã€åœ–è¡¨ï¼‰
å¿«å–å¾Œ: 12 Ã— 30% = 3.6 æ¬¡
ç¸½èª¿ç”¨: 36,000 æ¬¡/æœˆ
è²»ç”¨: (36,000 - 10,000) Ã— $0.005 = $130/æœˆ
```

### æˆæœ¬æ§åˆ¶æªæ–½

```typescript
1. å¿«å–ç­–ç•¥ï¼ˆæœ€é‡è¦ï¼‰
   - TTL: 5-10 åˆ†é˜
   - ç¯€çœ: 70%

2. æ™ºèƒ½ç¸®æ”¾
   - Zoom < 12: ä¸æŸ¥è©¢
   - Zoom > 15: æŒ‰éœ€æŸ¥è©¢

3. é˜²æŠ–è™•ç†
   - åœ°åœ–ç§»å‹•: 1 ç§’é˜²æŠ–
   - é¿å…é »ç¹æŸ¥è©¢

4. è«‹æ±‚åˆä½µ
   - æ‰¹é‡æŸ¥è©¢å¤šå€‹é»
   - æ¸›å°‘ HTTP è«‹æ±‚æ•¸

5. é™ç´šæ–¹æ¡ˆ
   - API é¡åº¦ç”¨å®Œæ™‚
   - åªé¡¯ç¤ºç†±åŠ›åœ–
```

**ç›®æ¨™æˆæœ¬**: $70-130/æœˆï¼ˆ10,000 MAUï¼‰

---

## é–‹ç™¼æŒ‡å—

### ç›®éŒ„çµæ§‹

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ air-quality/
â”‚   â”‚       â”œâ”€â”€ current/
â”‚   â”‚       â”‚   â””â”€â”€ route.ts          # ç•¶å‰æ•¸æ“š API
â”‚   â”‚       â”œâ”€â”€ forecast/
â”‚   â”‚       â”‚   â””â”€â”€ route.ts          # é æ¸¬æ•¸æ“š API
â”‚   â”‚       â””â”€â”€ history/
â”‚   â”‚           â””â”€â”€ route.ts          # æ­·å²æ•¸æ“š API
â”‚   â”œâ”€â”€ page.tsx                      # ä¸»é é¢
â”‚   â”œâ”€â”€ layout.tsx                    # Layout
â”‚   â””â”€â”€ globals.css                   # å…¨å±€æ¨£å¼
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ map/
â”‚   â”‚   â”œâ”€â”€ MapComponent.tsx          # åœ°åœ–çµ„ä»¶
â”‚   â”‚   â”œâ”€â”€ HeatmapLayer.tsx          # ç†±åŠ›åœ–å±¤
â”‚   â”‚   â””â”€â”€ AQIMarkers.tsx            # AQI æ¨™è¨˜
â”‚   â”œâ”€â”€ AirQualityPanel.tsx           # æ•¸æ“šé¢æ¿
â”‚   â”œâ”€â”€ SearchBar.tsx                 # æœå°‹æ¬„
â”‚   â””â”€â”€ LoadingSpinner.tsx            # è¼‰å…¥å‹•ç•«
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useGeolocation.ts             # ä½ç½®ç²å–
â”‚   â”œâ”€â”€ useAirQuality.ts              # æ•¸æ“šç²å–
â”‚   â”œâ”€â”€ useMapTracking.ts             # åœ°åœ–è¿½è¹¤
â”‚   â””â”€â”€ useMapZoom.ts                 # ç¸®æ”¾ç›£è½
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ airQualityService.ts          # API æœå‹™
â”‚   â””â”€â”€ cacheService.ts               # å¿«å–æœå‹™
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ constants.ts                  # å¸¸æ•¸å®šç¾©
â”‚   â””â”€â”€ utils.ts                      # å·¥å…·å‡½æ•¸
â””â”€â”€ types/
    â””â”€â”€ index.ts                      # TypeScript é¡å‹
```

### ç’°å¢ƒè®Šæ•¸

```bash
# .env.local

# Google Maps API Keyï¼ˆæœƒæš´éœ²åˆ°å‰ç«¯ï¼‰
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=your_maps_key

# Google Air Quality API Keyï¼ˆåªåœ¨æœå‹™ç«¯ä½¿ç”¨ï¼‰
GOOGLE_AIR_QUALITY_API_KEY=your_air_quality_key

# ç’°å¢ƒ
NODE_ENV=development
```

### é—œéµä»£ç¢¼ç¯„ä¾‹

#### 1. ä½ç½®ç²å– Hook
```typescript
// hooks/useGeolocation.ts
export function useGeolocation() {
  const [location, setLocation] = useState<Location | null>(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    getInitialLocation()
      .then(setLocation)
      .finally(() => setLoading(false));
  }, []);
  
  return { location, loading };
}
```

#### 2. API Route
```typescript
// app/api/air-quality/current/route.ts
export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url);
  const lat = parseFloat(searchParams.get('lat') || '0');
  const lng = parseFloat(searchParams.get('lng') || '0');
  
  // é©—è­‰åƒæ•¸
  if (!lat || !lng) {
    return NextResponse.json({ error: 'Invalid coordinates' }, { status: 400 });
  }
  
  // æª¢æŸ¥å¿«å–
  const cacheKey = getCacheKey(lat, lng);
  const cached = await cache.get(cacheKey);
  if (cached) {
    return NextResponse.json(cached);
  }
  
  // èª¿ç”¨ API
  const data = await airQualityService.getCurrentConditions(lat, lng);
  
  // å­˜å…¥å¿«å–
  await cache.set(cacheKey, data, 300); // 5 åˆ†é˜
  
  return NextResponse.json(data, {
    headers: { 'Cache-Control': 'public, s-maxage=300' }
  });
}
```

#### 3. ç†±åŠ›åœ–å±¤
```typescript
// components/map/HeatmapLayer.tsx
export function HeatmapLayer() {
  const map = useMap();
  
  useEffect(() => {
    if (!map) return;
    
    const heatmapLayer = new google.maps.ImageMapType({
      getTileUrl: (coord, zoom) => {
        const url = 'https://airquality.googleapis.com/v1/mapTypes/UAQI_RED_GREEN/heatmapTiles';
        return `${url}/${zoom}/${coord.x}/${coord.y}?key=${process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY}`;
      },
      tileSize: new google.maps.Size(256, 256),
      opacity: 0.6
    });
    
    map.overlayMapTypes.push(heatmapLayer);
    
    return () => {
      const index = map.overlayMapTypes.getArray().indexOf(heatmapLayer);
      if (index !== -1) map.overlayMapTypes.removeAt(index);
    };
  }, [map]);
  
  return null;
}
```

### é–‹ç™¼æµç¨‹

```bash
# 1. è¨­ç½®ç’°å¢ƒ
npm install
cp .env.example .env.local
# ç·¨è¼¯ .env.local å¡«å…¥ API Keys

# 2. å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
npm run dev

# 3. æ¸¬è©¦ API
curl "http://localhost:3000/api/air-quality/current?lat=25.033&lng=121.5654"

# 4. æ§‹å»ºç”Ÿç”¢ç‰ˆæœ¬
npm run build

# 5. æœ¬åœ°é è¦½ç”Ÿç”¢ç‰ˆæœ¬
npm run start
```

### æ¸¬è©¦æ¸…å–®

```
åŠŸèƒ½æ¸¬è©¦:
âœ… å…è¨±å®šä½ â†’ é¡¯ç¤ºç”¨æˆ¶ä½ç½®
âœ… æ‹’çµ•å®šä½ â†’ ä½¿ç”¨ IP å®šä½
âœ… IP å¤±æ•— â†’ é¡¯ç¤ºå°åŒ—
âœ… åœ°åœ–é¡¯ç¤ºæ­£ç¢º
âœ… ç†±åŠ›åœ–å±¤è¼‰å…¥
âœ… AQI æ•¸æ“šé¡¯ç¤º
âœ… é»æ“Šåœ°åœ–æŸ¥è©¢
âœ… ç§»å‹•åœ°åœ–æ›´æ–°

æ€§èƒ½æ¸¬è©¦:
âœ… é¦–å±è¼‰å…¥ < 3 ç§’
âœ… API éŸ¿æ‡‰ < 1 ç§’
âœ… å¿«å–å‘½ä¸­ç‡ > 60%
âœ… Lighthouse åˆ†æ•¸ > 85

å®‰å…¨æ¸¬è©¦:
âœ… API Key ä¸æš´éœ²
âœ… CORS è¨­ç½®æ­£ç¢º
âœ… é€Ÿç‡é™åˆ¶æœ‰æ•ˆ
âœ… éŒ¯èª¤è™•ç†å®Œå–„
```

---

## é‡Œç¨‹ç¢‘

### âœ… Milestone 1: è¨­è¨ˆå®Œæˆï¼ˆç•¶å‰ï¼‰
- å®Œæ•´æ¶æ§‹è¨­è¨ˆ
- æŠ€è¡“æ±ºç­–è¨˜éŒ„
- ç”¨æˆ¶é«”é©—æµç¨‹
- æˆæœ¬åˆ†æå®Œæˆ

### ğŸ¯ Milestone 2: MVP å®Œæˆï¼ˆWeek 2ï¼‰
- ä½ç½®ç²å–åŠŸèƒ½
- åœ°åœ–èˆ‡ç†±åŠ›åœ–é¡¯ç¤º
- API Routes å¯¦ç¾
- å–®é»æŸ¥è©¢åŠŸèƒ½

### ğŸ¯ Milestone 3: å„ªåŒ–å®Œæˆï¼ˆWeek 4ï¼‰
- åœ°åœ–ç§»å‹•è¿½è¹¤
- å‹•æ…‹ç¶²æ ¼é¡¯ç¤º
- å¿«å–å¯¦ç¾
- æœå°‹åŠŸèƒ½

### ğŸ¯ Milestone 4: ç”Ÿç”¢å°±ç·’ï¼ˆWeek 6ï¼‰
- å®Œæ•´åŠŸèƒ½
- æ€§èƒ½å„ªåŒ–
- éŒ¯èª¤è™•ç†
- éƒ¨ç½²ä¸Šç·š

---

## åƒè€ƒè³‡æ–™

### Google API æ–‡æª”
- [Air Quality API](https://developers.google.com/maps/documentation/air-quality)
- [Maps JavaScript API](https://developers.google.com/maps/documentation/javascript)
- [Places API](https://developers.google.com/maps/documentation/places/web-service)

### Next.js æ–‡æª”
- [App Router](https://nextjs.org/docs/app)
- [API Routes](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)
- [Environment Variables](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables)

### æœ€ä½³å¯¦è¸
- [Web.dev Performance](https://web.dev/performance/)
- [React Best Practices](https://react.dev/learn)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/handbook/intro.html)

---

## å¿«é€Ÿé–‹å§‹

```bash
# 1. é–±è®€æœ¬æ–‡æª”ï¼ˆ30 åˆ†é˜ï¼‰
cat .docs/plan.md

# 2. è¨­ç½®é–‹ç™¼ç’°å¢ƒï¼ˆ10 åˆ†é˜ï¼‰
npm install
cp .env.example .env.local

# 3. ç²å– API Keysï¼ˆ20 åˆ†é˜ï¼‰
# - Google Cloud Console
# - å•Ÿç”¨ Maps + Air Quality API

# 4. é–‹å§‹é–‹ç™¼ï¼ˆDay 1ï¼‰
npm run dev
# å‰µå»º hooks/useGeolocation.ts
```

---

**ä¸‹ä¸€æ­¥**: é–‹å§‹ Week 1 Day 1 - ä½ç½®ç²å–åŠŸèƒ½å¯¦ç¾ ğŸš€
